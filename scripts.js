// Language translations JSON mapping
const translations = {
    pt: {
        // Logo/Header
        website_title: "QUIOSQUE AL FORNO",
        
        // Pizza names and descriptions
        pepperoni_title: "PEPPERONI",
        pepperoni_desc: "Chouriço italiano picante com base de molho de tomate.",
        camponesa_title: "CAMPONESA",
        camponesa_desc: "Cogumelos frescos, fiambre, azeitonas e base de molho de tomate.",
        tentacao_title: "TENTAÇÃO",
        tentacao_desc: "Cogumelos frescos, chouriço picante, cebola roxa, azeitonas e base de molho de tomate.",
        saborosa_title: "SABOROSA",
        saborosa_desc: "Base de azeite de alho, mozzarella, cogumelos frescos, bacon.",
        pedecabra_title: "PÉ DE CABRA",
        pedecabra_desc: "Queijo de cabra, noz, mel, rúcula e base de molho de tomate.",
        margherita_title: "MARGHERITA",
        margherita_desc: "Mozzarella, manjericão, azeite, oregãos e base de molho de tomate.",
        
        // Allergy info
        allergy_info: "Para obter informações sobre alergénios e substâncias que causam intolerância em pratos de comida, pergunte à staff",
        
        // Menu button
        menu_button: "Ver Menu Completo",
        
        // Order section
        order_title: "ENCOMENDAR",
        order_call: "por chamada",
        
        // Hours section
        hours_title: "HORÁRIO",
        monday: "Segunda-feira: Encerrado",
        tuesday: "Terça-feira: Encerrado",
        wednesday: "Quarta-feira: 18:30 – 21:15",
        thursday: "Quinta-feira: 18:30 – 21:15",
        friday: "Sexta-feira: 18:00 – 21:30",
        saturday: "Sábado: 18:00 – 21:45",
        sunday: "Domingo: 18:00 – 21:15",
        
        // Catering section
        catering_title: "CATERING",
        catering_group_size: "Grupos de 15-100 pessoas",
        catering_menu: "Menu personalizado",
        catering_location: "No local à sua escolha",
        catering_contact: "Entre em contacto para orçamentos:",
        catering_note: "Por favor, inclua os seguintes detalhes para orçamento:",
        catering_people: "Número de pessoas",
        catering_place: "Localização",
        catering_date: "Data e hora",
        catering_event: "Tipo de evento ou ocasião",
        
        // Location section
        location_title: "LOCALIZAÇÃO",
        address_line1: "Assumadas-Tunes, estrada nacional 269",
        address_line2: "8365-235 Silves",
        
        // Social media section
        social_title: "SIGA-NOS",
        
        // Footer
        contact: "contacto:",
        
        // Catering page
        catering_hero_title: "Catering Events",
        catering_hero_subtitle: "Pizza autêntica em forno a lenha para o seu evento especial",
        catering_email_title: "Entre em Contacto",
        catering_email_text1: "Oferecemos serviço de catering para eventos corporativos, casamentos e festas privadas. Para solicitar mais informações ou obter um orçamento personalizado, entre em contacto connosco por e-mail:",
        catering_email_text2: "Ou contacte-nos diretamente por telefone:",
        
        // Menu modal
        menu_modal_title: "Menu Completo",
        download_button: "Transferir"
    },
    
    en: {
        // Logo/Header
        website_title: "QUIOSQUE AL FORNO",
        
        // Pizza names and descriptions
        pepperoni_title: "PEPPERONI",
        pepperoni_desc: "Spicy Italian chorizo with tomato sauce base.",
        camponesa_title: "CAMPONESA",
        camponesa_desc: "Fresh mushrooms, ham, olives and tomato sauce base.",
        tentacao_title: "TENTAÇÃO",
        tentacao_desc: "Fresh mushrooms, spicy chorizo, red onion, olives and tomato sauce base.",
        saborosa_title: "SABOROSA",
        saborosa_desc: "Garlic olive oil base, mozzarella, fresh mushrooms, bacon.",
        pedecabra_title: "PÉ DE CABRA",
        pedecabra_desc: "Goat cheese, walnuts, honey, arugula and tomato sauce base.",
        margherita_title: "MARGHERITA",
        margherita_desc: "Mozzarella, basil, olive oil, oregano and tomato sauce base.",
        
        // Allergy info
        allergy_info: "For information about allergens and substances that cause intolerance in food dishes, please ask our staff",
        
        // Menu button
        menu_button: "View Full Menu",
        
        // Order section
        order_title: "ORDER",
        order_call: "by phone",
        
        // Hours section
        hours_title: "OPENING HOURS",
        monday: "Monday: Closed",
        tuesday: "Tuesday: Closed",
        wednesday: "Wednesday: 18:30 – 21:15",
        thursday: "Thursday: 18:30 – 21:15",
        friday: "Friday: 18:00 – 21:30",
        saturday: "Saturday: 18:00 – 21:45",
        sunday: "Sunday: 18:00 – 21:15",
        
        // Catering section
        catering_title: "CATERING",
        catering_group_size: "Groups of 15-100 people",
        catering_menu: "Customized menu",
        catering_location: "At your chosen location",
        catering_contact: "Contact us for quotes:",
        catering_note: "Please include the following details for a quote:",
        catering_people: "Number of people",
        catering_place: "Location",
        catering_date: "Date and time",
        catering_event: "Type of event or occasion",
        
        // Location section
        location_title: "LOCATION",
        address_line1: "Assumadas-Tunes, national road 269",
        address_line2: "8365-235 Silves",
        
        // Social media section
        social_title: "FOLLOW US",
        
        // Footer
        contact: "contact:",
        
        // Catering page
        catering_hero_title: "Catering Events",
        catering_hero_subtitle: "Authentic wood-fired pizza for your special event",
        catering_email_title: "Contact Us",
        catering_email_text1: "We offer catering services for corporate events, weddings, and private parties. To request more information or get a personalized quote, please contact us by email:",
        catering_email_text2: "Or contact us directly by phone:",
        
        // Menu modal
        menu_modal_title: "Full Menu",
        download_button: "Download"
    },
    
    fr: {
        // Logo/Header
        website_title: "QUIOSQUE AL FORNO",
        
        // Pizza names and descriptions
        pepperoni_title: "PEPPERONI",
        pepperoni_desc: "Saucisse italienne épicée sur base de sauce tomate.",
        camponesa_title: "CAMPONESA",
        camponesa_desc: "Champignons frais, jambon, olives sur base de sauce tomate.",
        tentacao_title: "TENTAÇÃO",
        tentacao_desc: "Champignons frais, saucisse épicée, oignon rouge, olives sur base de sauce tomate.",
        saborosa_title: "SABOROSA",
        saborosa_desc: "Base d'huile d'olive à l'ail, mozzarella, champignons frais, lardons.",
        pedecabra_title: "PÉ DE CABRA",
        pedecabra_desc: "Fromage de chèvre, noix, miel, roquette sur base de sauce tomate.",
        margherita_title: "MARGHERITA",
        margherita_desc: "Mozzarella, basilic, huile d'olive, origan sur base de sauce tomate.",
        
        // Allergy info
        allergy_info: "Pour obtenir des informations sur les allergènes et les substances qui provoquent des intolérances dans les plats, veuillez demander à notre personnel",
        
        // Menu button
        menu_button: "Voir Menu Complet",
        
        // Order section
        order_title: "COMMANDER",
        order_call: "par téléphone",
        
        // Hours section
        hours_title: "HORAIRES",
        monday: "Lundi: Fermé",
        tuesday: "Mardi: Fermé",
        wednesday: "Mercredi: 18:30 – 21:15",
        thursday: "Jeudi: 18:30 – 21:15",
        friday: "Vendredi: 18:00 – 21:30",
        saturday: "Samedi: 18:00 – 21:45",
        sunday: "Dimanche: 18:00 – 21:15",
        
        // Catering section
        catering_title: "TRAITEUR",
        catering_group_size: "Groupes de 15 à 100 personnes",
        catering_menu: "Menu personnalisé",
        catering_location: "À l'endroit de votre choix",
        catering_contact: "Contactez-nous pour des devis:",
        catering_note: "Veuillez inclure les détails suivants pour un devis:",
        catering_people: "Nombre de personnes",
        catering_place: "Emplacement",
        catering_date: "Date et heure",
        catering_event: "Type d'événement ou d'occasion",
        
        // Location section
        location_title: "EMPLACEMENT",
        address_line1: "Assumadas-Tunes, route nationale 269",
        address_line2: "8365-235 Silves",
        
        // Social media section
        social_title: "SUIVEZ-NOUS",
        
        // Footer
        contact: "contact:",
        
        // Catering page
        catering_hero_title: "Service Traiteur",
        catering_hero_subtitle: "Pizza authentique cuite au feu de bois pour votre événement spécial",
        catering_email_title: "Contactez-Nous",
        catering_email_text1: "Nous proposons des services de traiteur pour les événements d'entreprise, mariages et fêtes privées. Pour demander plus d'informations ou obtenir un devis personnalisé, veuillez nous contacter par email:",
        catering_email_text2: "Ou contactez-nous directement par téléphone:",
        
        // Menu modal
        menu_modal_title: "Menu Complet",
        download_button: "Télécharger"
    }
};

// Current language (default: Portuguese)
let currentLang = 'pt';

// Menu image paths for different languages
const menuImages = {
    pt: [
        '/images/menu_pt.png',
        '/images/menu_pt2.png'
    ],
    en: [
        '/images/menu_en.png',
        '/images/menu_en2.png'
    ],
    fr: [
        '/images/menu_fr.png',
        '/images/menu_fr2.png'
    ]
};

// Function to translate the page
function translatePage(lang) {
    currentLang = lang;
    
    // Update document language and body data-lang attribute
    document.documentElement.lang = lang;
    document.body.setAttribute('data-lang', lang);
    
    const t = translations[lang];
    if (!t) return; // If translation not found, exit

    // Update menu images if they exist
    updateMenuImages(lang);
    
    // Detect if we're on catering page
    const isCateringPage = document.querySelector('.hero-section') !== null;
    
    if (isCateringPage) {
        // Translate catering page specific elements
        const heroTitle = document.querySelector('.hero-title');
        if (heroTitle) heroTitle.textContent = t.catering_hero_title;
        
        const heroSubtitle = document.querySelector('.hero-subtitle');
        if (heroSubtitle) heroSubtitle.textContent = t.catering_hero_subtitle;
        
        const emailTitle = document.querySelector('.email-title');
        if (emailTitle) emailTitle.textContent = t.catering_email_title;
        
        const emailTexts = document.querySelectorAll('.email-text');
        if (emailTexts.length >= 2) {
            emailTexts[0].textContent = t.catering_email_text1;
            emailTexts[1].textContent = t.catering_email_text2;
        }
    } else {
        // Translate pizza cards
        const pizzaCards = document.querySelectorAll('.pizza-card');
        if (pizzaCards.length >= 6) {
            // Pepperoni
            pizzaCards[0].querySelector('h2').textContent = t.pepperoni_title;
            pizzaCards[0].querySelector('p').textContent = t.pepperoni_desc;
            
            // Camponesa
            pizzaCards[1].querySelector('h2').textContent = t.camponesa_title;
            pizzaCards[1].querySelector('p').textContent = t.camponesa_desc;
            
            // Tentação
            pizzaCards[2].querySelector('h2').textContent = t.tentacao_title;
            pizzaCards[2].querySelector('p').textContent = t.tentacao_desc;
            
            // Saborosa
            pizzaCards[3].querySelector('h2').textContent = t.saborosa_title;
            pizzaCards[3].querySelector('p').textContent = t.saborosa_desc;
            
            // Pé de Cabra
            pizzaCards[4].querySelector('h2').textContent = t.pedecabra_title;
            pizzaCards[4].querySelector('p').textContent = t.pedecabra_desc;
            
            // Margherita
            pizzaCards[5].querySelector('h2').textContent = t.margherita_title;
            pizzaCards[5].querySelector('p').textContent = t.margherita_desc;
        }
        
        // Translate allergy info
        const allergyInfo = document.querySelector('.allergy-info p');
        if (allergyInfo) allergyInfo.textContent = t.allergy_info;
        
        // Translate menu button
        const menuLink = document.querySelector('.menu-link');
        if (menuLink) {
            menuLink.textContent = t.menu_button;
            menuLink.onclick = function(e) {
                e.preventDefault();
                // Create a new window with both images
                const menuWindow = window.open('', '_blank');
                menuWindow.document.write(`
                    <html>
                    <head>
                        <title>Menu - ${lang.toUpperCase()}</title>
                        <style>
                            body {
                                margin: 0;
                                padding: 20px;
                                background: #005742;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                gap: 20px;
                                min-height: 100vh;
                            }
                            img {
                                max-width: 80%;
                                width: 600px;
                                height: auto;
                                display: block;
                                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                            }
                            @media (max-width: 768px) {
                                img {
                                    max-width: 95%;
                                    width: 100%;
                                }
                            }
                        </style>
                    </head>
                    <body>
                        <img src="${menuImages[lang][0]}" alt="Menu Page 1">
                        <img src="${menuImages[lang][1]}" alt="Menu Page 2">
                    </body>
                    </html>
                `);
                menuWindow.document.close();
            };
        }
        
        // Translate order section
        const orderTitle = document.querySelector('.order-section h2');
        if (orderTitle) orderTitle.textContent = t.order_title;
        
        const orderText = document.querySelector('.order-section .order-text');
        if (orderText) orderText.textContent = t.order_call;
        
        // Translate hours section
        const hoursTitle = document.querySelector('.opening-hours-section h2');
        if (hoursTitle) hoursTitle.textContent = t.hours_title;
        
        const hoursParagraphs = document.querySelectorAll('.hours-content p');
        if (hoursParagraphs.length >= 7) {
            hoursParagraphs[0].textContent = t.monday;
            hoursParagraphs[1].textContent = t.tuesday;
            hoursParagraphs[2].textContent = t.wednesday;
            hoursParagraphs[3].textContent = t.thursday;
            hoursParagraphs[4].textContent = t.friday;
            hoursParagraphs[5].textContent = t.saturday;
            hoursParagraphs[6].textContent = t.sunday;
        }
        
        // Translate catering section
        const cateringTitle = document.querySelector('.catering-section h2');
        if (cateringTitle) cateringTitle.textContent = t.catering_title;
        
        const cateringDetails = document.querySelectorAll('.catering-detail span');
        if (cateringDetails.length >= 3) {
            cateringDetails[0].textContent = t.catering_group_size;
            cateringDetails[1].textContent = t.catering_menu;
            cateringDetails[2].textContent = t.catering_location;
        }
        
        const cateringContact = document.querySelector('.catering-contact');
        if (cateringContact) cateringContact.textContent = t.catering_contact;
        
        const cateringNote = document.querySelector('.catering-note');
        if (cateringNote) cateringNote.textContent = t.catering_note;
        
        const cateringRequirements = document.querySelectorAll('.catering-requirements li');
        if (cateringRequirements.length >= 4) {
            // Extract text content without the icon
            const extractText = (li) => {
                const newLi = li.cloneNode(true);
                const icon = newLi.querySelector('i');
                if (icon) icon.remove();
                return newLi.textContent.trim();
            };
            
            // Replace text content while preserving icon
            const updateLiText = (li, text) => {
                const icon = li.querySelector('i');
                li.textContent = '';
                if (icon) li.appendChild(icon);
                li.appendChild(document.createTextNode(' ' + text));
            };
            
            updateLiText(cateringRequirements[0], t.catering_people);
            updateLiText(cateringRequirements[1], t.catering_place);
            updateLiText(cateringRequirements[2], t.catering_date);
            updateLiText(cateringRequirements[3], t.catering_event);
        }
    }
    
    // Common elements for both pages
    
    // Translate location section
    const locationTitle = document.querySelector('.location-section h2');
    if (locationTitle) locationTitle.textContent = t.location_title;
    
    const addressParagraphs = document.querySelectorAll('.address p');
    if (addressParagraphs.length >= 2) {
        addressParagraphs[0].textContent = t.address_line1;
        addressParagraphs[1].textContent = t.address_line2;
    }
    
    // Translate social section
    const socialTitle = document.querySelector('.social-section h2');
    if (socialTitle) socialTitle.textContent = t.social_title;
    
    // Translate footer
    const footerContact = document.querySelector('.footer-contact p');
    if (footerContact && footerContact.firstChild && footerContact.firstChild.nodeType === Node.TEXT_NODE) {
        footerContact.firstChild.nodeValue = t.contact + ' ';
    }
    
    // Translate menu modal elements
    const downloadBtn = document.querySelector('.download-button .modal-download-text');
    if (downloadBtn) downloadBtn.textContent = t.download_button;
    
    const menuModalTitle = document.querySelector('.menu-modal-title');
    if (menuModalTitle) menuModalTitle.textContent = t.menu_modal_title;

    // Update directions link spans visibility
    const directionsLink = document.querySelector('.directions-link');
    if (directionsLink) {
        const spans = directionsLink.querySelectorAll('span');
        spans.forEach(span => {
            span.style.display = span.classList.contains(lang) ? 'inline' : 'none';
        });
    }
}

// Function to update menu images based on language
function updateMenuImages(lang) {
    const langMenuImages = menuImages[lang] || menuImages.pt; // Fallback to PT if language not found
    
    // Update the menu slide images
    const slides = document.querySelectorAll('.menu-slide');
    if (slides.length >= 2) {
        const img1 = slides[0].querySelector('img');
        const img2 = slides[1].querySelector('img');
        
        if (img1) {
            img1.src = langMenuImages[0];
            img1.alt = `Menu Page 1 (${lang.toUpperCase()})`;
        }
        
        if (img2) {
            img2.src = langMenuImages[1];
            img2.alt = `Menu Page 2 (${lang.toUpperCase()})`;
        }
    }
    
    // Update download paths
    updateDownloadPaths();
}

// Update download paths for the current language
function updateDownloadPaths() {
    const langMenuImages = menuImages[currentLang] || menuImages.pt;
    
    // Update download paths for each slide
    downloadPaths = [
        {path: langMenuImages[0], filename: `Menu_Quiosque_Al_Forno_1_${currentLang}.png`},
        {path: langMenuImages[1], filename: `Menu_Quiosque_Al_Forno_2_${currentLang}.png`}
    ];
    
    // Update the current download button if it exists
    const downloadBtn = document.getElementById('current-download-btn');
    if (downloadBtn && typeof currentSlide !== 'undefined') {
        downloadBtn.href = downloadPaths[currentSlide].path;
        downloadBtn.setAttribute('download', downloadPaths[currentSlide].filename);
    }
}

// Language toggle functionality
document.querySelectorAll('.language-toggle a').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        // Remove active class from all buttons
        document.querySelectorAll('.language-toggle a').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Add active class to clicked button
        this.classList.add('active');
        
        // Translate page
        const lang = this.getAttribute('data-lang');
        translatePage(lang);
    });
});

// Scroll animation system
function initScrollAnimations() {
    // Elements to animate on scroll
    const animatedElements = document.querySelectorAll('.scroll-animate');
    
    // Set up IntersectionObserver
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            // Add animation class when element enters viewport
            if (entry.isIntersecting) {
                // Get delay from data attribute if exists
                const delay = entry.target.dataset.delay;
                
                if (delay) {
                    // Apply delayed animation
                    setTimeout(() => {
                        entry.target.classList.add('animate');
                    }, parseFloat(delay) * 1000);
                } else {
                    // Apply immediate animation
                    entry.target.classList.add('animate');
                }
                
                // Unobserve after animation is triggered (optional)
                // This ensures the animation only happens once
                observer.unobserve(entry.target);
            }
        });
    }, {
        root: null, // Use viewport as root
        threshold: 0.15, // Trigger when 15% of element is visible
        rootMargin: '0px 0px -100px 0px' // Trigger slightly before element enters viewport
    });
    
    // Observe all elements with scroll-animate class
    animatedElements.forEach(element => {
        observer.observe(element);
        
        // Add animation type class based on data attribute
        const animationType = element.dataset.animation || 'fade-up';
        element.classList.add(animationType);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const body = document.body;
    
    // Add smooth page load 
    document.body.classList.add('page-loaded');
    
    // Initialize scroll animations
    setTimeout(() => {
        initScrollAnimations();
    }, 100);
    
    // Re-check scroll animations on scroll
    window.addEventListener('scroll', () => {
        requestAnimationFrame(() => {
            initScrollAnimations();
        });
    }, { passive: true });

    // Handle fixed language switcher and back to top button visibility
    const fixedLanguageToggle = document.querySelector('.fixed-language-toggle');
    const backToTopButton = document.querySelector('.back-to-top');
    const scrollThreshold = 300; // Show buttons after scrolling 300px

    function handleScroll() {
        if (window.scrollY > scrollThreshold) {
            fixedLanguageToggle.classList.add('visible');
            backToTopButton.classList.add('visible');
        } else {
            fixedLanguageToggle.classList.remove('visible');
            backToTopButton.classList.remove('visible');
        }
    }

    // Initial check
    handleScroll();

    // Add scroll event listener
    window.addEventListener('scroll', handleScroll);

    // Handle back to top click
    backToTopButton.addEventListener('click', function(e) {
        e.preventDefault();
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // Sync fixed language toggle with main language toggle
    const fixedLangButtons = fixedLanguageToggle.querySelectorAll('a');
    const mainLangButtons = document.querySelector('.language-toggle').querySelectorAll('a');

    fixedLangButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const lang = this.getAttribute('data-lang');
            
            // Update both language toggles
            fixedLangButtons.forEach(btn => btn.classList.remove('active'));
            mainLangButtons.forEach(btn => btn.classList.remove('active'));
            
            this.classList.add('active');
            mainLangButtons.forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });

            // Update language and translate page
            document.body.setAttribute('data-lang', lang);
            translatePage(lang);
        });
    });
});

// Initialize page in Portuguese
document.body.setAttribute('data-lang', 'pt');
translatePage('pt');